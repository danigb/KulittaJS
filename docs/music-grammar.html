<!DOCTYPE html>

<html>
<head>
  <title>Musical Grammar</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
                
                <a class="source" href="music-grammar.html">
                  music-grammar.js
                </a>
              
                
                <a class="source" href="ptgg.html">
                  ptgg.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="musical-grammar">Musical Grammar</h1>
<p><a href="https://github.com/donya/Kulitta/blob/master/Kulitta/Grammars/MusicGrammars.lhs">Original source code</a>
by Donya Quick</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* @flow */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="type-synonyms-constants">Type synonyms &amp; constants</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Duration is represented with a float (in relative units)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>type Dur = number</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Abstract pitch represented as a number (midi note number)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>type AbsPitch = number</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Some duration definitions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> wn : Dur = <span class="hljs-number">1</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> hn : Dur = <span class="hljs-number">1</span>/<span class="hljs-number">2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> qn : Dur = <span class="hljs-number">1</span>/<span class="hljs-number">4</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> en : Dur = <span class="hljs-number">1</span>/<span class="hljs-number">8</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> sn : Dur = <span class="hljs-number">1</span>/<span class="hljs-number">16</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> tn : Dur = <span class="hljs-number">1</span>/<span class="hljs-number">32</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="alphabets-for-base-symbols">Alphabets for base symbols</h2>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Alphabet 1: Roman numeral for abstract chords</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>type CType = <span class="hljs-string">'I'</span> | <span class="hljs-string">'II'</span> | <span class="hljs-string">'III'</span> | <span class="hljs-string">'IV'</span> | <span class="hljs-string">'V'</span> | <span class="hljs-string">'VI'</span> | <span class="hljs-string">'VII'</span> | <span class="hljs-string">'X'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2 id="alphabets-for-parameters">Alphabets for parameters</h2>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Many finite base symbol alphabets can use the same potentially infinite alphabet of parameter symbols. Here we define a general “music parameter” or MP for many tonal applications. It will store the current duration of a symbol, and the symbol’s tonal context as a mode and scale root.
Finally, there is allowance for keeping track of the onset of the symbol as well as the total duration of the sentence to which it belongs. This allows for checking things like whether the symbols is the LAST in a sentence, at the midpoint, etc.</p>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>The “Music Parameter” definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>type MP = { <span class="hljs-attr">dur</span>: Dur, <span class="hljs-attr">mode</span>: Mode, <span class="hljs-attr">key</span>: number, <span class="hljs-attr">onset</span>: Dur, <span class="hljs-attr">seqDur</span>: Dur }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><em>Modes</em> include the seven usual derivatives of the C-major scale along with chromatic and custom options. Note that Major=Ionian and Minor=Aeoloean.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>type Mode = <span class="hljs-string">'Major'</span> | <span class="hljs-string">'Dorian'</span> | <span class="hljs-string">'Phrygian'</span> | <span class="hljs-string">'Lydian'</span> | <span class="hljs-string">'Mixolydian'</span>
  | <span class="hljs-string">'Minor'</span> | <span class="hljs-string">'Locrian'</span> | <span class="hljs-string">'Chormatic'</span> | [<span class="hljs-string">'Custom'</span>, <span class="hljs-built_in">Array</span>&lt;AbsPitch&gt;]</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>A default MP value is one measure long (in 4/4) in the key of C-major.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> defaultMP : MP = { <span class="hljs-attr">dur</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">mode</span>: <span class="hljs-string">'Major'</span>, <span class="hljs-attr">key</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">onset</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">seqDur</span>: <span class="hljs-number">1</span> }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>It is also useful to have tests for MP values and modifiers for them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isMaj = (param: MP) : <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> param.mode === <span class="hljs-string">'Major'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isMin = (param: MP) : <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> param.mode === <span class="hljs-string">'Minor'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h2 id="modifiers">Modifiers</h2>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Modifier is a function to perform music parameter updtes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>type Modifier = <span class="hljs-function">(<span class="hljs-params">param: MP</span>) =&gt;</span> MP</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Modifiers on duration can be used to succinctly write transformations.
For example, to halve the duration of a parameter <code>param: MP</code>, one need only
write <code>h(param)</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> durFactor = (factor: number) : <span class="hljs-function"><span class="hljs-params">Modifier</span> =&gt;</span> (param: MP) : <span class="hljs-function"><span class="hljs-params">MP</span> =&gt;</span>
  <span class="hljs-built_in">Object</span>.assign({}, param, { <span class="hljs-attr">dur</span>: param.dur * factor })

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> h = durFactor(<span class="hljs-number">0.5</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> q = durFactor(<span class="hljs-number">0.25</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> e = durFactor(<span class="hljs-number">0.125</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Similarly, we have some shorthands for adjusting the onsets and
durations at the same time. NOTE: offsets should be changed
before the duration is changed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> onsetOffsetFactor = (factor: number) : <span class="hljs-function"><span class="hljs-params">Modifier</span> =&gt;</span> (param: MP) : <span class="hljs-function"><span class="hljs-params">MP</span> =&gt;</span>
  <span class="hljs-built_in">Object</span>.assign({}, param, { <span class="hljs-attr">onset</span>: param.onset + param.dur * factor })

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> q2 = onsetOffsetFactor(<span class="hljs-number">1</span>/<span class="hljs-number">4</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> q3 = onsetOffsetFactor(<span class="hljs-number">2</span>/<span class="hljs-number">4</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> q4 = onsetOffsetFactor(<span class="hljs-number">3</span>/<span class="hljs-number">4</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>We can also do shorthands that do both things.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> compose = (a : Modifier, <span class="hljs-attr">b</span>: Modifier) : <span class="hljs-function"><span class="hljs-params">Modifier</span> =&gt;</span> (p: MP) : <span class="hljs-function"><span class="hljs-params">MP</span> =&gt;</span> a(b(p))
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ho = compose(h, q3)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> qo2 = compose(q, q2)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> qo3 = compose(q, q3)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> qo4 = compose(q, q4)</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h2 id="rules">Rules</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">import</span> type { Rule } <span class="hljs-keyword">from</span> <span class="hljs-string">'./ptgg'</span>
<span class="hljs-keyword">import</span> { newRule } <span class="hljs-keyword">from</span> <span class="hljs-string">'./ptgg'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>The following alter Rules to do a duration test. Each has a
“rejection condition” that will be the condition for an ID rule.</p>

            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>The rejection condition in this case tests the left-hand-side
symbol’s duration.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toRelDuration</span> (<span class="hljs-params">isValidDur: (dur: Dur</span>) =&gt; <span class="hljs-title">boolean</span>, <span class="hljs-title">rule</span>: <span class="hljs-title">Rule</span>&lt;<span class="hljs-title">CType</span>, <span class="hljs-title">MP</span>&gt;) : <span class="hljs-title">Rule</span>&lt;<span class="hljs-title">CType</span>, <span class="hljs-title">MP</span>&gt; </span>{
  <span class="hljs-keyword">const</span> { prob, symbol, fn } = rule
  <span class="hljs-keyword">return</span> newRule(prob, symbol, (param: MP) =&gt; fn(param))
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
